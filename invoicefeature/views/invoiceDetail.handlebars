<div class="invoice-detail-container">
    <header class="invoice-detail-header">
        <h1>Invoice #{{invoice._id}}</h1>
        <a href="/invoices" class="back-btn">Back to Invoices</a>
    </header>

    <div class="invoice-info">
        <div class="info-section">
            <h2>Invoice Information</h2>
            <p><strong>Company:</strong> {{invoice.companyName}}</p>
            <p><strong>Work Order ID:</strong> {{invoice.workOrderId}}</p>
            <p><strong>Status:</strong> 
                <span class="status-badge status-{{invoice.status}}">
                    {{invoice.status}}
                </span>
            </p>
            <p><strong>Issued Date:</strong> {{invoice.issuedDate}}</p>
            {{#if invoice.paidDate}}
            <p><strong>Paid Date:</strong> {{invoice.paidDate}}</p>
            {{/if}}
        </div>

        <div class="items-section">
            <h2>Line Items</h2>
            <table class="items-table">
                <thead>
                    <tr>
                        <th>Charge Code</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each invoice.items}}
                    <tr>
                        <td>{{this.chargeCode}}</td>
                        <td>{{this.description}}</td>
                        <td>{{this.quantity}}</td>
                        <td>${{this.price}}</td>
                        <td>${{this.lineTotal}}</td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>

        <div class="totals-section">
            <div class="total-row">
                <span>Subtotal:</span>
                <span>${{invoice.subtotal}}</span>
            </div>
            <div class="total-row">
                <span>Tax ({{invoice.taxRate}}%):</span>
                <span>${{invoice.tax}}</span>
            </div>
            <div class="total-row total-final">
                <span>Total:</span>
                <span>${{invoice.total}}</span>
            </div>
        </div>

        {{#if (eq user.role 'admin')}}
        <div class="status-update">
            <h2>Update Status</h2>
            <form method="POST" action="/invoices/{{invoice._id}}/status">
                <select name="status">
                    <option value="draft" {{#if (eq invoice.status 'draft')}}selected{{/if}}>Draft</option>
                    <option value="issued" {{#if (eq invoice.status 'issued')}}selected{{/if}}>Issued</option>
                    <option value="paid" {{#if (eq invoice.status 'paid')}}selected{{/if}}>Paid</option>
                    <option value="cancelled" {{#if (eq invoice.status 'cancelled')}}selected{{/if}}>Cancelled</option>
                </select>
                <button type="submit">Update</button>
            </form>
        </div>
        {{/if}}
    </div>
</div>

<style>
    .invoice-detail-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    .invoice-detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
    }

    .invoice-detail-header h1 {
        font-size: 28px;
        color: #333;
    }

    .back-btn {
        padding: 8px 16px;
        background-color: #2196f3;
        color: white;
        text-decoration: none;
        border-radius: 4px;
    }

    .invoice-info {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-section,
    .items-section,
    .totals-section,
    .status-update {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }

    .info-section h2,
    .items-section h2,
    .status-update h2 {
        font-size: 20px;
        margin-bottom: 15px;
        color: #333;
    }

    .info-section p {
        margin: 10px 0;
        font-size: 14px;
    }

    .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: capitalize;
    }

    .status-draft {
        background-color: #9e9e9e;
        color: white;
    }

    .status-issued {
        background-color: #2196f3;
        color: white;
    }

    .status-paid {
        background-color: #4caf50;
        color: white;
    }

    .status-cancelled {
        background-color: #f44336;
        color: white;
    }

    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .items-table th,
    .items-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .items-table th {
        background-color: #f5f5f5;
        font-weight: 600;
    }

    .totals-section {
        max-width: 400px;
        margin-left: auto;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        font-size: 16px;
    }

    .total-final {
        font-weight: bold;
        font-size: 20px;
        border-top: 2px solid #333;
        padding-top: 15px;
    }

    .status-update form {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .status-update select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .status-update button {
        padding: 8px 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }

    .status-update button:hover {
        background-color: #45a049;
    }
</style>